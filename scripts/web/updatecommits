#!/usr/bin/env python3

import datetime
import feedparser
from jinja2 import Template

# URL of the RSS feed
rss_url = 'https://github.com/aros-development-team/AROS/commits.atom'

# Parse the RSS feed
feed = feedparser.parse(rss_url)

# HTML template
html_template = """
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS Feed</title>
    <meta name="lastupdate" content="{{ date }}">
</head>
<body>
    <!-- This file is automatically generated by the AROS/scripts/updatecommits script -->
    {% for entry in entries %}
        <h2><a href="{{ entry.link }}" target="_top">{{ entry.title }} | {{ entry.author }} | {{ entry.date[:10] }}</a></h2>
    {% endfor %}
</body>
</html>
"""

# Render the HTML
template = Template(html_template)
html_content = template.render(feed=feed.feed, entries=feed.entries, date=datetime.datetime.now())

# Write the HTML content to a file
with open('/home/project-web/aros/htdocs/commits.php', 'w', encoding='utf-8') as f:
    f.write(html_content)

